# 功能說明

Thai HD30 Vision 提供 11 種智能警報類型與完整的市場監控功能。

---

## 警報系統

### 警報類型總覽

| 類型 | 圖示 | 觸發條件 | 嚴重性 | 說明 |
|------|------|----------|--------|------|
| 價格大漲 | ▲ | 漲幅 ≥ 5% | warning/critical | 股價顯著上漲 |
| 價格大跌 | ▼ | 跌幅 ≤ -5% | warning/critical | 股價顯著下跌 |
| 成交量爆增 | ⚡ | 成交量 > 平均 × 3 | warning | 異常交易量 |
| 高殖利率 | ▲ | 殖利率 ≥ 6% | info | 高股息標的 |
| 股息公告 | ฿ | 除息日 7 天內 | info | 配息資訊 |
| 新聞快訊 | ⓘ | 最新新聞 | info/warning | 市場新聞 |
| 財報發布 | 📄 | 財報公布 30 天內 | info/warning | EPS 驚喜度 |
| 法說會 | 📊 | 14 天內舉行 | info | 法人說明會 |
| 內部人交易 | 👥 | 董監事交易 7 天內 | info/warning | 大股東動向 |
| 外資動向 | 🌐 | 淨買賣超 > 1M 股 | info/warning | 外資進出 |
| 技術指標 | 📈 | RSI/MACD 訊號 | info/warning | 技術分析 |

---

## 詳細說明

### 1. 價格大漲 (price_surge)

**觸發條件**:
- 當日漲幅 ≥ 5%

**嚴重性**:
- 漲幅 ≥ 10%: critical (紅色)
- 漲幅 5-10%: warning (橙色)

**訊息格式**:
```
大漲 X.XX%
```

**使用場景**:
- 追蹤強勢股
- 突破關鍵價位
- 利多消息發酵

---

### 2. 價格大跌 (price_drop)

**觸發條件**:
- 當日跌幅 ≤ -5%

**嚴重性**:
- 跌幅 ≤ -10%: critical (紅色)
- 跌幅 -10% ~ -5%: warning (橙色)

**訊息格式**:
```
大跌 X.XX%
```

**使用場景**:
- 風險警示
- 止損參考
- 逢低買進機會

---

### 3. 成交量爆增 (volume_spike)

**觸發條件**:
- 當日成交量 > 平均成交量 × 3

**嚴重性**: warning

**訊息格式**:
```
成交量爆增 XXX%
```

**使用場景**:
- 主力進場訊號
- 籌碼異動
- 重大消息確認

---

### 4. 高殖利率 (high_yield)

**觸發條件**:
- 殖利率 ≥ 6%

**嚴重性**: info

**訊息格式**:
```
高殖利率 X.XX%
```

**使用場景**:
- 存股標的篩選
- 穩定配息股
- 被動收入來源

---

### 5. 股息公告 (dividend)

**資料來源**: `dividend_history` 表

**觸發條件**:
- 除息日在未來 7 天內

**嚴重性**: info

**訊息格式**:
```
配息 ฿X.XX (除息日 YYYY-MM-DD)
```

**使用場景**:
- 除息日提醒
- 配息金額確認
- 參與除息決策

---

### 6. 新聞快訊 (news_flash)

**資料來源**: `market_news` 表

**觸發條件**:
- 最新發布的新聞 (最多 3 筆)

**嚴重性**:
- regulatory (監管類): warning
- 其他: info

**訊息格式**:
```
[中文翻譯的新聞標題]
```

**使用場景**:
- 重大消息追蹤
- 政策變動
- 產業動態

---

### 7. 財報發布 (earnings_report)

**資料來源**: `earnings_reports` 表

**觸發條件**:
- 財報發布日期在 30 天內

**嚴重性**:
- EPS 驚喜度 > 20%: warning
- 其他: info

**訊息格式**:
```
財報優於預期 EPS X.XX (預估 X.XX)
財報低於預期 EPS X.XX (預估 X.XX)
```

**資料欄位**:
- `revenue`: 營收
- `revenue_yoy_growth`: 營收年增率
- `net_income`: 淨利
- `eps`: 每股盈餘
- `eps_estimate`: EPS 預估值
- `eps_surprise`: EPS 驚喜度 (%)

**使用場景**:
- 財報公布追蹤
- 獲利成長評估
- 超預期/低於預期判斷

---

### 8. 法說會 (investor_conference)

**資料來源**: `investor_conferences` 表

**觸發條件**:
- 法說會日期在未來 14 天內

**嚴重性**: info

**訊息格式**:
```
法說會: [會議標題]
```

**資料欄位**:
- `conference_date`: 會議時間
- `title`: 會議標題
- `description`: 會議說明
- `is_online`: 是否線上
- `webcast_url`: 直播連結

**使用場景**:
- 法說會行事曆
- 公司展望了解
- 重要資訊揭露

---

### 9. 內部人交易 (insider_trading)

**資料來源**: `insider_trading` 表

**觸發條件**:
- 交易日期在 7 天內

**嚴重性**:
- 買進: info
- 賣出: warning

**訊息格式**:
```
[職位] 買進 X.XM 股
[職位] 賣出 X.XM 股
```

**資料欄位**:
- `insider_name`: 內部人姓名
- `insider_position`: 職位 (董事長、總經理等)
- `transaction_type`: 交易類型 (buy/sell)
- `shares`: 股數
- `price`: 成交價
- `total_value`: 總金額
- `ownership_after`: 交易後持股比例

**使用場景**:
- 董監事信心指標
- 大股東動向
- 內部人持股變化

---

### 10. 外資動向 (foreign_flow)

**資料來源**: `foreign_flow` 表

**觸發條件**:
- 交易日期在 5 天內
- 淨買賣超 > 1M 股

**嚴重性**:
- 買超: info
- 賣超: warning

**訊息格式**:
```
外資買超 X.XM 股
外資賣超 X.XM 股
```

**資料欄位**:
- `buy_volume`: 買進股數
- `sell_volume`: 賣出股數
- `net_volume`: 淨買賣超
- `buy_value`: 買進金額
- `sell_value`: 賣出金額
- `net_value`: 淨買賣超金額
- `ownership_percent`: 外資持股比例

**使用場景**:
- 外資動向追蹤
- 籌碼面分析
- 連續買超/賣超判斷

---

### 11. 技術指標 (technical_signal)

**資料來源**: `technical_indicators` 表

**觸發條件**:
- RSI > 70 (超買)
- RSI < 30 (超賣)
- MACD 金叉 (histogram > 0 且 MACD > Signal)
- MACD 死叉 (histogram < 0 且 MACD < Signal)

**嚴重性**:
- 超買/死叉: warning
- 超賣/金叉: info

**訊息格式**:
```
RSI 超買 XX.X
RSI 超賣 XX.X
MACD 金叉
MACD 死叉
```

**資料欄位**:
- `rsi_14`: RSI (14日)
- `macd`: MACD 值
- `macd_signal`: MACD 訊號線
- `macd_histogram`: MACD 柱狀圖
- `ma_5`, `ma_20`, `ma_60`: 均線
- `bb_upper`, `bb_middle`, `bb_lower`: 布林通道

**使用場景**:
- 技術分析訊號
- 超買超賣判斷
- 趨勢轉折確認

---

## 跑馬燈功能

### 顯示邏輯

1. **資料來源整合**:
   - 即時價格異動 (大漲、大跌、成交量)
   - 基本面資料 (高殖利率、股息)
   - 新聞與公告
   - 進階警報 (財報、法說會、內部人、外資、技術)

2. **優先級排序**:
   - 嚴重性: critical > warning > info
   - 變動幅度: 絕對值越大越優先
   - 時間: 越新越優先

3. **顯示數量**:
   - 跑馬燈: 最多 15 筆
   - 警報歷史: 最多 10 筆

### 互動功能

**Hover 暫停**:
- 滑鼠移至跑馬燈時自動暫停
- 移開後恢復滾動

**點擊查看**:
- 點擊警報項目
- 開啟股票詳情面板
- 顯示完整資訊

**自動更新**:
- WebSocket 推送新警報
- 自動加入跑馬燈
- 無需手動刷新

---

## 警報歷史

### 功能特色

**位置**: 右上角鈴鐺圖示

**顯示內容**:
- 最近 10 筆警報
- 股票代號
- 警報訊息
- 變動百分比 (如適用)
- 相對時間 (剛剛、X分鐘前、X小時前、X天前)

**互動**:
- 點擊鈴鐺開啟面板
- 點擊警報查看股票詳情
- 點擊 X 或外部區域關閉

**資料來源**: `ticker_alerts` 表

**自動清理**: 每支股票保留最近 100 筆

---

## 股票詳情面板

### 顯示資訊

**基本資料**:
- 股票代號與名稱
- 即時價格
- 漲跌幅
- 殖利率

**估值雷達圖**:
- 5 個維度視覺化
- 0-100 分數制
- 顏色標示 (金色線條)

**價格圖表**:
- 最近 10 個交易日
- 互動式 Tooltip
- 響應式設計

**估值指標**:
- 本益比 (P/E)
- 淨值比 (P/B)
- 殖利率
- 配息率

---

## WebSocket 即時更新

### 訂閱機制

**訂閱表格**:
- `price_logs`: 價格更新
- `market_news`: 新聞發布
- `dividend_history`: 股息公告

**更新流程**:
1. 資料庫有新記錄
2. Supabase Realtime 推送
3. 前端接收事件
4. 生成新警報
5. 更新跑馬燈

**程式碼位置**: `src/lib/realtime.ts`

---

## 自動儲存機制

### 儲存時機

每次頁面載入或刷新時:
1. 抓取股票資料
2. 生成警報項目
3. 自動儲存前 10 筆到 `ticker_alerts` 表

### 資料保留

**Trigger 自動清理**:
- 每次插入新警報時觸發
- 每支股票保留最近 100 筆
- 自動刪除舊記錄

**優點**:
- 無需手動維護
- 避免資料庫無限增長
- 保持查詢效能

---

## 估值計算

### 計算公式

**殖利率分數** (0-100):
```
score = min(yield / 10 * 100, 100)
```

**本益比分數** (0-100):
```
score = max(100 - (PE / 30 * 100), 0)
```

**淨值比分數** (0-100):
```
score = max(100 - (PB / 3 * 100), 0)
```

**成長性分數** (0-100):
- 基於營收年增率
- 基於 EPS 成長率

**穩定性分數** (0-100):
- 基於價格波動率
- 基於配息穩定性

### 總分計算

```
總分 = (殖利率 + 本益比 + 淨值比 + 成長性 + 穩定性) / 5
```

---

## 使用建議

### 存股族

**關注警報**:
- 高殖利率
- 股息公告
- 財報發布 (獲利穩定性)

**篩選條件**:
- 殖利率 ≥ 6%
- 配息率穩定
- 本益比合理

### 波段操作

**關注警報**:
- 價格大漲/大跌
- 成交量爆增
- 技術指標訊號

**篩選條件**:
- RSI 超賣後反彈
- MACD 金叉
- 外資連續買超

### 價值投資

**關注警報**:
- 財報優於預期
- 法說會
- 內部人買進

**篩選條件**:
- EPS 成長
- 本益比低於產業平均
- 董監事增持

---

## 常見問題

**Q: 警報多久更新一次?**

A: 
- 即時警報 (價格、成交量): 每次頁面載入
- 財報、法說會: 手動更新或 Cron Job
- 新聞: WebSocket 即時推送

**Q: 如何新增自選股?**

A: 目前版本追蹤 SETHD 30 成分股,自選股功能規劃中。

**Q: 價格資料來源?**

A: Google Finance (每 15 分鐘更新),可整合 SET 官方 API。

**Q: 支援其他市場嗎?**

A: 目前專注泰國股市,未來可擴展至其他東南亞市場。

---

## 下一步規劃

- 技術指標圖表 (MACD, RSI, MA)
- Gemini AI 分析
- 價格警報系統
- 機構追蹤
- 自選股功能
- 行動 App
